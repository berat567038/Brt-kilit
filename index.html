<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Serversiz Araba Oyunu</title>
    <style>
        body { background-color: #333; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>

    <script>
    // --- PreloadScene.js KODU BAŞLANGICI ---
    class PreloadScene extends Phaser.Scene {
        constructor() { super('PreloadScene'); }
        preload() { this.createPlaceholderImages(); }
        create() { this.scene.start('CarSelectionScene'); }
        createPlaceholderImages() {
            let roadGraphics = this.make.graphics({x: 0, y: 0}, false);
            roadGraphics.fillStyle(0x555555).fillRect(0, 0, 100, 100).fillStyle(0xffffff, 0.6).fillRect(48, 0, 4, 100);
            roadGraphics.generateTexture('road', 100, 100).destroy();
            let car1Graphics = this.make.graphics({x: 0, y: 0}, false);
            car1Graphics.fillStyle(0xff0000).fillRect(0, 0, 40, 80).fillStyle(0x000000, 0.5).fillRect(5, 10, 30, 20);
            car1Graphics.generateTexture('car1', 40, 80).destroy();
            let car2Graphics = this.make.graphics({x: 0, y: 0}, false);
            car2Graphics.fillStyle(0x0000ff).fillRect(0, 0, 40, 80).fillStyle(0x000000, 0.5).fillRect(5, 10, 30, 20);
            car2Graphics.generateTexture('car2', 40, 80).destroy();
            let signalGraphics = this.make.graphics({x: 0, y: 0}, false);
            signalGraphics.fillStyle(0xffa500).fillRect(0, 0, 10, 10);
            signalGraphics.generateTexture('signal', 10, 10).destroy();
        }
    }

    // --- CarSelectionScene.js KODU BAŞLANGICI ---
    class CarSelectionScene extends Phaser.Scene {
        constructor() { super('CarSelectionScene'); }
        create() {
            this.add.text(400, 100, 'Arabanı Seç', { fontSize: '48px', fill: '#ffffff' }).setOrigin(0.5);
            const car1Button = this.add.image(250, 300, 'car1').setScale(1.5).setInteractive();
            car1Button.on('pointerdown', () => this.scene.start('GameScene', { selectedCarKey: 'car1' }));
            const car2Button = this.add.image(550, 300, 'car2').setScale(1.5).setInteractive();
            car2Button.on('pointerdown', () => this.scene.start('GameScene', { selectedCarKey: 'car2' }));
        }
    }

    // --- GameScene.js KODU BAŞLANGICI ---
    class GameScene extends Phaser.Scene {
        constructor() { super('GameScene'); }
        init(data) { this.selectedCarKey = data.selectedCarKey; }
        create() {
            this.road = this.add.tileSprite(400, 300, 800, 600, 'road');
            this.car = this.physics.add.sprite(400, 500, this.selectedCarKey);
            this.car.setCollideWorldBounds(true).setDamping(true).setDrag(0.98).setMaxVelocity(400);
            this.leftSignal = this.add.sprite(0, 0, 'signal').setVisible(false);
            this.rightSignal = this.add.sprite(0, 0, 'signal').setVisible(false);
            this.cameras.main.startFollow(this.car, true, 0.08, 0.08);
            this.cursors = this.input.keyboard.createCursorKeys();
            this.keyQ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q);
            this.keyE = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);
            this.speedText = this.add.text(10, 10, 'Hız: 0 km/s', { font: '18px Arial', fill: '#ffffff' }).setScrollFactor(0);
            this.signalText = this.add.text(10, 30, 'Sinyal: Kapalı', { font: '18px Arial', fill: '#ffffff' }).setScrollFactor(0);
            this.time.addEvent({ delay: 400, callback: this.flashSignals, callbackScope: this, loop: true });
        }
        update() {
            this.road.tilePositionY -= this.car.body.velocity.length() * 0.05;
            if (this.cursors.left.isDown) { this.car.setAngularVelocity(-200); }
            else if (this.cursors.right.isDown) { this.car.setAngularVelocity(200); }
            else { this.car.setAngularVelocity(0); }
            if (this.cursors.up.isDown) { this.physics.velocityFromRotation(this.car.rotation - Math.PI / 2, 600, this.car.body.acceleration); }
            else { this.car.setAcceleration(0); }
            this.speedText.setText('Hız: ' + Math.floor(this.car.body.velocity.length()) + ' km/s');
            if (Phaser.Input.Keyboard.JustDown(this.keyQ)) { this.isLeftSignalOn = !this.isLeftSignalOn; this.isRightSignalOn = false; }
            if (Phaser.Input.Keyboard.JustDown(this.keyE)) { this.isRightSignalOn = !this.isRightSignalOn; this.isLeftSignalOn = false; }
            const angle = this.car.rotation; const offsetX = 25;
            this.leftSignal.setPosition(this.car.x - offsetX * Math.cos(angle), this.car.y - offsetX * Math.sin(angle));
            this.rightSignal.setPosition(this.car.x + offsetX * Math.cos(angle), this.car.y + offsetX * Math.sin(angle));
        }
        flashSignals() {
            let status = 'Kapalı';
            if (this.isLeftSignalOn) { this.leftSignal.setVisible(!this.leftSignal.visible); this.rightSignal.setVisible(false); status = 'Sol'; }
            else if (this.isRightSignalOn) { this.rightSignal.setVisible(!this.rightSignal.visible); this.leftSignal.setVisible(false); status = 'Sağ'; }
            else { this.leftSignal.setVisible(false); this.rightSignal.setVisible(false); }
            this.signalText.setText('Sinyal: ' + status);
        }
    }

    // --- main.js KODU BAŞLANGICI ---
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
        scene: [PreloadScene, CarSelectionScene, GameScene]
    };
    const game = new Phaser.Game(config);

    </script>
</body>
</html>
